{% extends 'layouts/sidebar.html.twig' %}

{% block sidebar_content %}
    <article class="markdown-body entry-content" itemprop="text">
        <h1><a id="user-content-feathers-elasticsearch" class="anchor" aria-hidden="true"
               href="#feathers-elasticsearch">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>feathers-elasticsearch
        </h1>
        <p><a href="https://github.com/feathersjs-ecosystem/feathers-elasticsearch/">feathers-elasticsearch</a> is a
            database adapter for <a href="https://www.elastic.co/products/elasticsearch"
                                    rel="nofollow">Elasticsearch</a>. This adapter is not using any ORM, it is dealing
            with the database directly through the <a
                    href="https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/quick-start.html"
                    rel="nofollow">elasticsearch.js client</a>.</p>
        <div class="highlight highlight-source-shell">
            <pre><code class="hljs">$ npm install --save elasticsearch feathers-elasticsearch</code></pre>
        </div>
        <blockquote>
            <p><strong>Important:</strong> <code>feathers-elasticsearch</code> implements the <a
                        href="https://docs.feathersjs.com/api/databases/common.html" rel="nofollow">Feathers Common
                    database adapter API</a> and <a href="https://docs.feathersjs.com/api/databases/querying.html"
                                                    rel="nofollow">querying syntax</a>.</p>
        </blockquote>
        <h2><a id="user-content-getting-started" class="anchor" aria-hidden="true" href="#getting-started">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Getting Started
        </h2>
        <p>The following bare-bones example will create a <code>messages</code> endpoint and connect to a local <code>messages</code>
            type in the <code>test</code> index in your Elasticsearch database:</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs"><span class="pl-k">const</span> <span
                        class="pl-c1">feathers</span> <span class="pl-k">=</span> <span
                        class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>@feathersjs/feathers<span
                            class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">elasticsearch</span> <span class="pl-k">=</span> <span
                        class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>elasticsearch<span
                            class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">service</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span
                        class="pl-s"><span class="pl-pds">'</span>feathers-elasticsearch<span
                            class="pl-pds">'</span></span>);

<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-s"><span class="pl-pds">'</span>/messages<span
                            class="pl-pds">'</span></span>, <span class="pl-en">service</span>({
  Model<span class="pl-k">:</span> <span class="pl-k">new</span> <span class="pl-en">elasticsearch.Client</span>({
    host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>localhost:9200<span
                            class="pl-pds">'</span></span>,
    apiVersion<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>5.0<span
                            class="pl-pds">'</span></span>
  }),
  elasticsearch<span class="pl-k">:</span> {
    index<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>test<span
                            class="pl-pds">'</span></span>,
    type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>messages<span
                            class="pl-pds">'</span></span>
  }
}));
                </code></pre>
        </div>
        <h2><a id="user-content-options" class="anchor" aria-hidden="true" href="#options">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Options
        </h2>
        <p>The following options can be passed when creating a new Elasticsearch service:</p>
        <ul>
            <li><code>Model</code> (<strong>required</strong>) - The Elasticsearch client instance.</li>
            <li><code>elasticsearch</code> (<strong>required</strong>) - Configuration object for elasticsearch
                requests. The required properties are <code>index</code> and <code>type</code>. Apart from that you can
                specify anything that can be passed to all requests going to Elasticsearch. Another recognised property
                is <a href="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/near-real-time.html#refresh-api"
                      rel="nofollow"><code>refresh</code></a> which is set to <code>false</code> by default. Anything
                else use at your own risk.
            </li>
            <li><code>id</code> (default: '_id') [optional] - The id property of your documents in this service.</li>
            <li><code>meta</code> (default: '_meta') [optional] - The meta property of your documents in this service.
                The meta field is an object containing elasticsearch specific information, e.g. _score, _type, _index,
                and so forth.
            </li>
            <li><code>paginate</code> [optional] - A pagination object containing a <code>default</code> and
                <code>max</code> page size (see the <a
                        href="https://docs.feathersjs.com/api/databases/common.html#pagination" rel="nofollow">Pagination
                    documentation</a>).
            </li>
        </ul>
        <h2><a id="user-content-complete-example" class="anchor" aria-hidden="true" href="#complete-example">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Complete Example
        </h2>
        <p>Here's an example of a Feathers server that uses <code>feathers-elasticsearch</code>.</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs"><span class="pl-k">const</span> <span
                        class="pl-c1">feathers</span> <span class="pl-k">=</span> <span
                        class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>@feathersjs/feathers<span
                            class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">rest</span> <span class="pl-k">=</span> <span
                        class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>@feathersjs/express/rest<span
                            class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">express</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span
                        class="pl-s"><span class="pl-pds">'</span>@feathersjs/express<span
                            class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">service</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span
                        class="pl-s"><span class="pl-pds">'</span>feathers-elasticsearch<span
                            class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">elasticsearch</span> <span class="pl-k">=</span> <span
                        class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>elasticsearch<span
                            class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">messageService</span> <span class="pl-k">=</span> <span
                        class="pl-en">service</span>({
  Model<span class="pl-k">:</span> <span class="pl-k">new</span> <span class="pl-en">elasticsearch.Client</span>({
    host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>localhost:9200<span
                            class="pl-pds">'</span></span>,
    apiVersion<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>5.0<span
                            class="pl-pds">'</span></span>
  }),
  paginate<span class="pl-k">:</span> {
    default<span class="pl-k">:</span> <span class="pl-c1">10</span>,
    max<span class="pl-k">:</span> <span class="pl-c1">50</span>
  },
  elasticsearch<span class="pl-k">:</span> {
    index<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>test<span
                            class="pl-pds">'</span></span>,
    type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>messages<span
                            class="pl-pds">'</span></span>
  }
});

<span class="pl-c"><span class="pl-c">//</span> Initialize the application</span>
<span class="pl-k">const</span> <span class="pl-c1">app</span> <span class="pl-k">=</span> <span
                        class="pl-en">express</span>(<span class="pl-en">feathers</span>());

<span class="pl-c"><span class="pl-c">//</span> Needed for parsing bodies (login)</span>
<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">json</span>());
<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">urlencoded</span>({ extended<span
                        class="pl-k">:</span> <span class="pl-c1">true</span> }));
<span class="pl-c"><span class="pl-c">//</span> Enable REST services</span>
<span class="pl-smi">app</span>.<span class="pl-en">configure</span>(<span class="pl-smi">express</span>.<span
                        class="pl-en">rest</span>());
<span class="pl-c"><span class="pl-c">//</span> Initialize your feathers plugin</span>
<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-s"><span class="pl-pds">'</span>/messages<span
                            class="pl-pds">'</span></span>, messageService);
<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">errorHandler</span>());;

<span class="pl-smi">app</span>.<span class="pl-en">listen</span>(<span class="pl-c1">3030</span>);

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Feathers app started on 127.0.0.1:3030<span
                            class="pl-pds">'</span></span>);
                </code></pre>
        </div>
        <p>You can run this example by using <code>npm start</code> and going to <a
                    href="http://localhost:3030/messages" rel="nofollow">localhost:3030/messages</a>.
            You should see an empty array. That's because you don't have any messages yet but you now have full CRUD for
            your new message service!</p>
        <h2><a id="user-content-supported-elasticsearch-specific-queries" class="anchor" aria-hidden="true"
               href="#supported-elasticsearch-specific-queries">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Supported Elasticsearch specific queries
        </h2>
        <p>On top of the standard, cross-adapter <a
                    href="/feathersjs-ecosystem/feathers-elasticsearch/blob/master/querying.md">queries</a>,
            feathers-elasticsearch also supports Elasticsearch specific queries.</p>
        <h3><a id="user-content-all" class="anchor" aria-hidden="true" href="#all">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$all
        </h3>
        <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-all-query.html"
              rel="nofollow">The simplest query <code>match_all</code></a>. Find all documents.</p>
        <div class="highlight highlight-source-js"><pre>query<span class="pl-k">:</span> {
  $all<span class="pl-k">:</span> <span class="pl-c1">true</span>
}</pre>
        </div>
        <h3><a id="user-content-prefix" class="anchor" aria-hidden="true" href="#prefix">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$prefix
        </h3>
        <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html"
              rel="nofollow">Term level query <code>prefix</code></a>. Find all documents which have given field
            containing terms with a specified prefix (not analyzed).</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  user<span class="pl-k">:</span> {
    $prefix<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>bo<span
                            class="pl-pds">'</span></span>
  }
}
                </code></pre>
        </div>
        <h3><a id="user-content-match" class="anchor" aria-hidden="true" href="#match">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$match
        </h3>
        <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html"
              rel="nofollow">Full text query <code>match</code></a>. Find all documents which have given given fields
            matching the specified value (analysed).</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  bio<span class="pl-k">:</span> {
    $match<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>javascript<span
                            class="pl-pds">'</span></span>
  }
}
                </code></pre>
        </div>
        <h3><a id="user-content-phrase" class="anchor" aria-hidden="true" href="#phrase">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$phrase
        </h3>
        <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html"
              rel="nofollow">Full text query <code>match_phrase</code></a>. Find all documents which have given given
            fields matching the specified phrase (analysed).</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  bio<span class="pl-k">:</span> {
    $phrase<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>I like JavaScript<span
                            class="pl-pds">'</span></span>
  }
}
                </code></pre>
        </div>
        <h3><a id="user-content-phrase_prefix" class="anchor" aria-hidden="true" href="#phrase_prefix">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$phrase_prefix
        </h3>
        <p>
            <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html"
               rel="nofollow">Full text query <code>match_phrase_prefix</code></a>. Find all documents which have given
            given fields matching the specified phrase prefix (analysed).</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  bio<span class="pl-k">:</span> {
    $phrase_prefix<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>I like JavaS<span
                            class="pl-pds">'</span></span>
  }
}
                </code></pre>
        </div>
        <h3><a id="user-content-child" class="anchor" aria-hidden="true" href="#child">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$child
        </h3>
        <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-child-query.html"
              rel="nofollow">Joining query <code>has_child</code></a>.
            Find all documents which have children matching the query. The <code>$child</code> query is essentially a
            full-blown query of its own. The <code>$child</code> query requires <code>$type</code> property.</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  $child<span class="pl-k">:</span> {
    $type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>blog_tag<span
                            class="pl-pds">'</span></span>,
    tag<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>something<span
                            class="pl-pds">'</span></span>
  }
}
                </code></pre>
        </div>
        <h3><a id="user-content-parent" class="anchor" aria-hidden="true" href="#parent">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$parent
        </h3>
        <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-parent-query.html"
              rel="nofollow">Joining query <code>has_parent</code></a>.
            Find all documents which have parent matching the query. The <code>$parent</code> query is essentially a
            full-blown query of its own. The <code>$parent</code> query requires <code>$type</code> property.</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  $parent<span class="pl-k">:</span> {
    $type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>blog<span
                            class="pl-pds">'</span></span>,
    title<span class="pl-k">:</span> {
      $match<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>javascript<span
                            class="pl-pds">'</span></span>
    }
  }
}
                </code></pre>
        </div>
        <h3><a id="user-content-and" class="anchor" aria-hidden="true" href="#and">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$and
        </h3>
        <p>This operator does not translate directly to any Elasticsearch query, but it provides support for <a
                    href="https://www.elastic.co/guide/en/elasticsearch/reference/current/array.html" rel="nofollow">Elasticsearch
                array datatype</a>.
            Find all documents which match all of the given criteria. As any field in Elasticsearch can contain an
            array, therefore sometimes it is important to match more than one value per field.</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  $and<span class="pl-k">:</span> [
    { notes<span class="pl-k">:</span> { $match<span class="pl-k">:</span> <span class="pl-s"><span
                            class="pl-pds">'</span>javascript<span class="pl-pds">'</span></span> } },
    { notes<span class="pl-k">:</span> { $match<span class="pl-k">:</span> <span class="pl-s"><span
                            class="pl-pds">'</span>project<span class="pl-pds">'</span></span> } }
  ]
}
                </code></pre>
        </div>
        <p>There is also a shorthand version of <code>$and</code> for equality. For instance:</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  $and<span class="pl-k">:</span> [
    { tags<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>javascript<span
                            class="pl-pds">'</span></span> },
    { tags<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span> }
  ]
}
                </code></pre>
        </div>
        <p>Can be also expressed as:</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  tags<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>javascript<span
                            class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react<span
                            class="pl-pds">'</span></span>]
}
                </code></pre>
        </div>
        <h3><a id="user-content-sqs" class="anchor" aria-hidden="true" href="#sqs">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>$sqs
        </h3>
        <p>
            <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html"
               rel="nofollow">simple_query_string</a>. A query that uses the SimpleQueryParser to parse its context.
            Optional <code>$operator</code> which is set to <code>or</code> by default but can be set to
            <code>and</code> if required.</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs">query<span class="pl-k">:</span> {
  $sqs<span class="pl-k">:</span> {
    $fields<span class="pl-k">:</span> [
      <span class="pl-s"><span class="pl-pds">'</span>title^5<span class="pl-pds">'</span></span>,
      <span class="pl-s"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span>
    ],
    $query<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>+like +javascript<span
                            class="pl-pds">'</span></span>,
    $operator<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>and<span
                            class="pl-pds">'</span></span>
  }
}
                </code></pre>
        </div>
        <p>This can also be expressed in an URL as the following:</p>
        <div class="highlight highlight-source-httpspec">
            <pre><code class="hljs">http://localhost:<span class="pl-c1">3030</span>/users?$sqs[<span class="pl-ii">$fields</span>][]=title^<span
                        class="pl-c1">5</span>&amp;$sqs[<span class="pl-ii">$fields</span>][]=description&amp;$sqs[<span
                        class="pl-ii">$query</span>]=+like +javascript&amp;$sqs[<span class="pl-ii">$operator</span>]=and
                </code></pre>
        </div>
        <h2><a id="user-content-parent-child-relationship" class="anchor" aria-hidden="true"
               href="#parent-child-relationship">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Parent-child relationship
        </h2>
        <p>Elasticsearch supports <a
                    href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-parent-field.html"
                    rel="nofollow">parent-child relationship</a>, however it is not exactly the same as in relational
            databases. feathers-elasticsearch supports all CRUD operations for Elasticsearch types with parent mapping,
            and does that with the Elasticsearch constrains. Therefore:</p>
        <ul>
            <li>each operation concering a single document (create, get, patch, update, remove) is required to provide
                parent id
            </li>
            <li>creating documents in bulk (providing a list of documents) is the same as many single document
                operations, so parent id is required as well
            </li>
            <li>to avoid any doubts, each query based operation (find, bulk patch, bulk remove) cannot have the parent
                id
            </li>
        </ul>
        <p>Parent id should be provided as part of the data for the create operations (single and bulk):</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs"><span class="pl-smi">parentService</span>.<span class="pl-en">create</span>({
  _id<span class="pl-k">:</span> <span class="pl-c1">123</span>,
  title<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>JavaScript: The Good Parts<span
                            class="pl-pds">'</span></span>
});

<span class="pl-smi">childService</span>.<span class="pl-en">create</span>({
  _id<span class="pl-k">:</span> <span class="pl-c1">1000</span>
  tag<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>javascript<span class="pl-pds">'</span></span>,
  _parent<span class="pl-k">:</span> <span class="pl-c1">123</span>
})
                </code></pre>
        </div>
        <p>Please note, that name of the parent property (<code>_parent</code> by default) is configurable through the
            service options, so that you can set it to whatever suits you.</p>
        <p>For all other operations (get, patch, update, remove), the parent id should be provided as part of the
            query:</p>
        <div class="highlight highlight-source-js"><pre><code class="hljs"><span class="pl-smi">childService</span>.<span class="pl-c1">remove</span>(
  <span class="pl-c1">1000</span>,
  { query<span class="pl-k">:</span> { _parent<span class="pl-k">:</span> <span class="pl-c1">123</span> } }
);
                </code></pre>
        </div>
        <h2><a id="user-content-supported-elasticsearch-versions" class="anchor" aria-hidden="true"
               href="#supported-elasticsearch-versions">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Supported Elasticsearch versions
        </h2>
        <p>feathers-elasticsearch is currently tested on Elasticsearch 2.4, 5.0, 5.1, 5.2, 5.3, 5.4, 5.5 and 5.6. Please
            note, event though the lowest version supported is 2.4, that does not mean it wouldn't work fine on anything
            lower than 2.4.</p>
        <h2><a id="user-content-quirks" class="anchor" aria-hidden="true" href="#quirks">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Quirks
        </h2>
        <h3><a id="user-content-updating-and-deleting-by-query" class="anchor" aria-hidden="true"
               href="#updating-and-deleting-by-query">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Updating and deleting by query
        </h3>
        <p>Elasticsearch is special in many ways. For example, the <a
                    href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-update-by-query.html"
                    rel="nofollow">"update by query"</a> API is still considered experimental and so is the <a
                    href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-delete-by-query.html"
                    rel="nofollow">"delete by query"</a> API introduced in Elasticsearch 5.0.</p>
        <p>Just to clarify - update in Elasticsearch is an equivalent to <code>patch</code> in feathers. I will use
            <code>patch</code> from now on, to set focus on the feathers side of the fence.</p>
        <p>Considering the above, our implementation of path / remove by query uses combo of find and bulk patch /
            remove, which in turn means for you:</p>
        <ul>
            <li>Standard pagination is taken into account for patching / removing by query, so you have no guarantee
                that all existing documents matching your query will be patched / removed.
            </li>
            <li>The operation is a bit slower than it could potentially be, because of the two-step process involved.
            </li>
        </ul>
        <p>Considering, however that elasticsearch is mainly used to dump data in it and search through it, I presume
            that should not be a great problem.</p>
        <h3><a id="user-content-search-visibility" class="anchor" aria-hidden="true" href="#search-visibility">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Search visibility
        </h3>
        <p>Please be aware that search visibility of the changes (creates, updates, patches, removals) is going to be
            delayed due to Elasticsearch <a
                    href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html"
                    rel="nofollow"><code>index.refresh_interval</code></a> setting. You may force refresh after each
            operation by setting the service option <code>elasticsearch.refresh</code> as decribed above but it is
            highly discouraged due to Elasticsearch performance implications.</p>
        <h3><a id="user-content-full-text-search" class="anchor" aria-hidden="true" href="#full-text-search">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Full-text search
        </h3>
        <p>Currently feathers-elasticsearch supports most important full-text queries in their default form.
            Elasticsearch search allows additional parameters to be passed to each of those queries for fine-tuning.
            Those parameters can change behaviour and affect peformance of the queries therefore I believe they should
            not be exposed to the client. I am considering ways of adding them safely to the queries while retaining
            flexibility.</p>
        <h3><a id="user-content-performance-considerations" class="anchor" aria-hidden="true"
               href="#performance-considerations">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>Performance considerations
        </h3>
        <p>None of the data mutating operations in Elasticsearch v2.4 (create, update, patch, remove) returns the full
            resulting document, therefore I had to resolve to using get as well in order to return complete data. This
            solution is of course adding a bit of an overhead, although it is also compliant with the standard behaviour
            expected of a feathers database adapter.</p>
        <p>The conceptual solution for that is quite simple. This behaviour will be configurable through a
            <code>lean</code> switch allowing to get rid of those additional gets should they be not needed for your
            application. This feature will be added soon as well.</p>
        <h2><a id="user-content-license" class="anchor" aria-hidden="true" href="#license">
                <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                </svg>
            </a>License
        </h2>
        <p>Copyright (c) 2017</p>
        <p>Licensed under the <a href="https://github.com/feathersjs-ecosystem/feathers-elasticsearch/blob/master/LICENSE">MIT license</a>.
        </p>
    </article>
    {% endblock %}
